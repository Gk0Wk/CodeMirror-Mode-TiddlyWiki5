(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";e.defineMode("tiddlywiki5",function(t,o){function n(o){if(e.findModeByName){var n=e.findModeByName(o);n&&(o=n.mime||n.mimes[0])}var i=e.getMode(t,o);return"null"==i.name?null:i}function i(e,t,o){return t.tokenize=o,o(e,t)}function r(e){e.line++,e.listLevel=0,e.boldLine=!1}function a(e,t){var o=e.sol(),n=l(o,e,t);return null==n&&(n=""),t.quoteLevel>0&&o&&(n+=" quote quote-"+t.quoteLevel),null!=t.codeBlockModeState&&(n+=" comment"),t.listLevel>0&&(n+=" list "+h.rainbow[t.listLevel%h.rainbow.length]),t.boldLine&&(n+=" strong"),n}function l(e,t,o){var n=t.peek();if(e&&/[<\/\*{}\-`]/.test(n)){if(t.match(x))return S(t,o);if(t.match(B))return"hr";var r=null;if(r=t.match(y,!1))return b(t,o,r)}var a=null;if(e&&(a=t.match(/^\s*([\/\*!#;:>|])/))){if(n=a[1],"!"===n){for(var l=1;t.eat("!");)l++;return t.skipToEnd(),"header h"+l}if(/[\*#;:]/.test(n)){for(var L=1,T=n;n=t.eat(/[\*#;:]/);)L++,T=n;return o.boldLine=";"===T,o.listLevel=L,"list "+h.rainbow[L%h.rainbow.length]+(";"===T?" strong":"")}if(">"===n)return t.eatWhile(">"),"quote";if("|"===n)return"header"}return t.next(),/[hf]/i.test(n)&&/[ti]/i.test(t.peek())&&t.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i,!0)?"externallink link":"$"==n&&t.match("$",!1)&&!t.match("$$",!1)?(t.next(),p(t,o)):"`"==n?i(t,o,c):"/"==n&&t.eat("/")?i(t,o,u):"{"==n&&t.eat("{")?i(t,o,f):"["==n&&t.eat("[")?i(t,o,k):"_"==n&&t.eat("_")?i(t,o,s):"^"==n&&t.eat("^")?i(t,o,v):","==n&&t.eat(",")?i(t,o,m):"~"==n&&t.eat("~")?i(t,o,M):"'"==n&&t.eat("'")?i(t,o,d):"<"==n&&t.eat("<")?i(t,o,g):null}function d(e,t){for(var o,n=!1;o=e.next();){if("'"==o&&n){t.tokenize=a;break}n="'"==o}return"strong"}function c(e,t){for(var o;o=e.next();)if("`"==o){t.tokenize=a;break}return"comment"}function u(e,t){for(var o,n=!1;o=e.next();){if("/"==o&&n){t.tokenize=a;break}n="/"==o}return"em"}function f(e,t){for(var o,n=!1;o=e.next();){if("}"==o&&n){t.tokenize=a;break}n="}"==o}return"builtin"}function k(e,t){if("[["==e.current())return t.pastDivider=!1,"link";if("]"==e.peek()&&(e.next(),"]"==e.next()))return t.tokenize=a,"link";for(var o,n=t.pastDivider;o=e.peek();){if(!n&&"|"==o)return e.next(),t.pastDivider=!0,"internallink link";if("]"==o&&"]"==e.peek())return"internallink link";if(o=e.next(),/[hf]/i.test(o)&&/[ti]/i.test(e.peek())&&e.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i,!0))return"externallink link";e.eatWhile(/[^|\]]/)}return null}function s(e,t){for(var o,n=!1;o=e.next();){if("_"==o&&n){t.tokenize=a;break}n="_"==o}return"underlined"}function m(e,t){for(var o,n=!1;o=e.next();){if(","==o&&n){t.tokenize=a;break}n=","==o}return"string subscript"}function v(e,t){for(var o,n=!1;o=e.next();){if("^"==o&&n){t.tokenize=a;break}n="^"==o}return"string superscript"}function M(e,t){for(var o,n=!1;o=e.next();){if("~"==o&&n){t.tokenize=a;break}n="~"==o}return"strikethrough"}function p(t,i){i.tokenize=a;var r=o.fencedCodeBlockHighlighting&&n("text/x-latex");return i.LaTeXModeState=r?{mode:r,state:e.startState(r)}:"unknown","comment"}function b(t,i,r){return i.tokenize=function(t,i){i.tokenize=a;var l=o.fencedCodeBlockHighlighting&&n(r[1]||o.fencedCodeBlockDefaultMode);return i.codeBlockModeState=l?{mode:l,state:e.startState(l)}:"unknown",r[1]?(t.skipToEnd(),"tag"):null},t.match("```"),"comment"}function S(e,t){for(var o=1;e.match(x);)o++;return t.quoteLevel==o?t.quoteLevel--:t.quoteLevel<o?(t.quoteHead=!0,t.quoteLevel=o,t.tokenize=function(e,t){return t.quoteHead=!1,t.tokenize=a,e.sol()?null:(e.skipToEnd(),"tag")}):t.quoteLevel=o-1,"quote"}function g(e,t){if("<<"==e.current())return"macro";var o=e.next();return o?">"==o&&">"==e.peek()?(e.next(),t.tokenize=a,"macro"):(e.eatWhile(/[\w\$_]/),L.propertyIsEnumerable(e.current())?"keyword":"macro"):(t.tokenize=a,null)}var h={rainbow:["keyword","variable-2","variable-3"]},L={changecount:!0,colour:!0,"colour-picker":!0,contrastcolour:!0,"copy-to-clipboard":!0,csvtiddlers:!0,datauri:!0,dumpvariables:!0,"image-picker":!0,jsontiddler:!0,jsontiddlers:!0,lingo:!0,"list-links":!0,"list-links-draggable":!0,"list-tagged-draggable":!0,"list-thumbnails":!0,makedatauri:!0,now:!0,qualify:!0,resolvepath:!0,"box-shadow":!0,filter:!0,transition:!0,"background-linear-gradient":!0,"transform-origin":!0,toc:!0,"toc-expandable":!0,"toc-selective-expandable":!0,"toc-tabbed-internal-nav":!0,"toc-tabbed-external-nav":!0,tabs:!0,tag:!0,"tag-picker":!0,"tag-pill":!0,thumbnail:!0,timeline:!0,tree:!0,unusedtitle:!0,version:!0};void 0===o.fencedCodeBlockHighlighting&&(o.fencedCodeBlockHighlighting=!0),void 0===o.fencedCodeBlockDefaultMode&&(o.fencedCodeBlockDefaultMode="text/plain");var B=/^\-\-\-+$/,x=/^<<</,y=/^```[ \t]*([\w\/+#-]*)[^\n`]*$/,T=/^```$/,z={blankLine:r,closeBrackets:"()[]{}''\"\"``",startState:function(){return{tokenize:a,curStream:null,line:0,quoteLevel:0,quoteHead:!1,listLevel:0,boldLine:!1,codeBlockModeState:null,LaTeXModeState:null}},copyState:function(t){var o={};for(var n in t)o[n]=t[n];t.codeBlockModeState&&"object"==typeof t.codeBlockModeState&&(o.codeBlockModeState={mode:t.codeBlockModeState.mode,state:e.copyState(t.codeBlockModeState.mode,t.codeBlockModeState.state)}),t.LaTeXModeState&&(o.LaTeXModeState={mode:t.LaTeXModeState.mode,state:e.copyState(t.LaTeXModeState.mode,t.LaTeXModeState.state)})},token:function(e,t){return e!=t.curStream&&(r(t),t.curStream=e),null!=t.codeBlockModeState?e.match(T)?(t.codeBlockModeState=null,"comment"):"string"==typeof t.codeBlockModeState?(e.skipToEnd(),"comment"):t.codeBlockModeState.mode.token(e,t.codeBlockModeState.state):null!=t.LaTeXModeState?e.match("$$")?(t.LaTeXModeState=null,"comment"):"string"==typeof t.LaTeXModeState?(e.skipToEnd(),"comment"):t.LaTeXModeState.mode.token(e,t.LaTeXModeState.state):e.match(/^\s+$/,!0)||e.match(/\s+$/,!0)?null:t.tokenize(e,t)},innerMode:function(e){return null!=e.codeBlockModeState&&"object"==typeof e.codeBlockModeState?e.codeBlockModeState:null!=e.LaTeXModeState&&"object"==typeof e.LaTeXModeState?e.LaTeXModeState:{state:e,mode:z}},indent:function(t,o,n){return null!=t.codeBlockModeState&&"object"==typeof t.codeBlockModeState&&"function"==typeof t.codeBlockModeState.mode.indent?t.codeBlockModeState.mode.indent(t.codeBlockModeState.state,o,n):e.Pass}};return z}),e.defineMIME("text/vnd.tiddlywiki","tiddlywiki5"),e.defineMIME("","tiddlywiki5")});